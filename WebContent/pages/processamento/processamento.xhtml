<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
		
	<ui:composition template="/new-template/template-crud.xhtml">
    
    	<ui:define name="tituloPagina">
    		<h:outputText value="Processamento" />
    	</ui:define>
    	
   		<ui:define name="pageScript">
			<script type="text/javascript"
				src="#{request.contextPath}/resources/js/tooltip/tooltip.js" />
		</ui:define>
    	
		<ui:define name="parametros">
    	   <ui:param name="bean" value="#{processamentoBean}" />
    	</ui:define>

   		<ui:define name="botoesFiltro">
				<p:commandButton value="Processar"
						 actionListener="#{bean.processarArquivo()}" 
						 styleClass="btn btn-primary"
						 update=":painelGlobal"
						 ajax="false"/>
		</ui:define>
    	
    	<ui:define name="tituloFieldSetFiltro">
    		Importar Arquivos
		</ui:define>
		
		<script>
			$(document).ready(function(){
				$(".valor").mask('######.##0,00', {reverse: true});
			});
		</script>
		
		<ui:define name="camposFiltro">
			<fieldset>
				<div class="row">
					<div class="col-md-4">
							<div class="form-group">
							<h:outputText value="Ano " />
							<h:selectOneMenu id="anoSearch"
											 value="#{bean.arquivo.ano}"
											 converter="entityConverter" styleClass="form-control"
											 required="true">
								<f:selectItem itemLabel="SELECIONE" itemValue="#{null}" />
								<f:selectItems var="o" itemValue="#{o}" itemLabel="#{o.ano}"
										value="#{bean.anos}" />
							</h:selectOneMenu>
							<h:message for="anoSearch" tooltip="true"
							styleClass="error-messages" />
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<h:outputText value="Mês " />
							<h:selectOneMenu id="mesSearch"
											 value="#{bean.arquivo.mes}"
											 converter="entityConverter" styleClass="form-control"
											 required="true">
								<f:selectItem itemLabel="SELECIONE" itemValue="#{null}" />
								<f:selectItems var="o" itemValue="#{o}" itemLabel="#{o.descricao.toUpperCase()}"
										value="#{bean.meses}" />
							</h:selectOneMenu>
							<h:message for="mesSearch" tooltip="true"
							styleClass="error-messages" />
						</div>
					</div>
				</div>	
				<div class="row">
					<div class="col-md-4">
							<div class="form-group">
							<h:outputText value="Cidade " />
							<h:selectOneMenu id="cidadeSearch"
											 value="#{bean.arquivo.cidade}"
											 converter="entityConverter" styleClass="form-control"
											 required="true">
								<f:selectItem itemLabel="SELECIONE" itemValue="#{null}" />
								<f:selectItems var="o" itemValue="#{o}" itemLabel="#{o.descricao.toUpperCase()}"
										value="#{bean.cidades}" />
							</h:selectOneMenu>
							<h:message for="cidadeSearch" tooltip="true"
							styleClass="error-messages" />
						</div>
					</div>
					<div class="col-md-4 form-group">
						<h:outputText value="Tipo Arquivo " />
						<h:selectOneMenu id="tipoArquivoSearch" 
										 value="#{bean.arquivo.tipoArquivo}" 
										 required="true"
										 converter="enumConverter" styleClass="form-control">
							<f:selectItem itemLabel="SELECIONE" itemValue="#{null}" />
							<f:selectItems var="o" itemValue="#{o}" itemLabel="#{o.descricao.toString().toUpperCase()}" 
										   value="#{bean.tiposArquivos}" />		   
						</h:selectOneMenu>
						<h:message for="tipoArquivoSearch" tooltip="true"
							styleClass="error-messages" />	
					</div>
				</div>	
				<div class="row">
					<div class="col-md-8 form-group">
						<h:outputLabel value="Selecione o Arquivo " />
						<p:fileUpload id="file" required="true" value="#{bean.file}"  allowTypes="/(\.|\/)(pdf)$/" process="@this" mode="simple" skinSimple="true"/>
						<h:message for="file" tooltip="true"
							styleClass="error-messages" />
					</div>
				</div>	
			</fieldset>		
		</ui:define>	
		
		<ui:define name="tituloPainel">
			<ui:param name="tituloPainel" value="Processamento Arquivo" />
		</ui:define>
	
		<ui:define name="resultResumo" >	
			<div class="result-filtro-container"> 
				<p:panel id="panelArquivo" header="Resumo Arquivo" rendered="#{bean.exibirResumoArquivo}">
					<div class="result-filtro-container"> 
						<br/>	
						<div class="row"> 
							<div class="col-md-6 form-group">
								<h:outputLabel value="Nome Arquivo: " style="font-weight: bold;"/>
								<h:outputText id="nomeArquivo" value=" #{bean.arquivoProcessado.nomeArquivo}" />
							</div>
						</div>	
						<div class="row"> 
							<div class="col-md-6 form-group" >
								<h:outputLabel value="Data Processamento: " style="font-weight: bold;"/>
								<h:outputText id="dataProcessamento" value=" #{bean.arquivoProcessado.dataProcessamento}" >
								  <f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
								</h:outputText>
							</div>
						</div>	
						<div class="row"> 
							<div class="col-md-6 form-group">
								<h:outputLabel value="Total Pagamentos: " style="font-weight: bold;"/>
								<h:outputText id="totalPagamentos" value=" #{bean.arquivoProcessado.totalPagamentos}" />
							</div>
						</div>
						<div class="row">
							<div class="col-md-6 form-group">
								<h:outputLabel value="Total Proventos: R$ " style="font-weight: bold;"/>
								<h:outputText id="totalProventosArquivo" value=" #{bean.arquivoProcessado.totalProventos}" converter="valorNumericoMoedaConverter"/>
				   			</div>	
						</div>	
						<div class="row"> 
							<div class="col-md-6 form-group">
								<h:outputLabel value="Total Líquidos: R$ " style="font-weight: bold;"/>
								<h:outputText id="totalLiquidoArquivo" value=" #{bean.arquivoProcessado.totalLiquido}" converter="valorNumericoMoedaConverter"/>
				   			</div>	
						</div>	
						<div class="row"> 
							<div class="col-md-6 form-group">
								<h:outputLabel value="Total Descontos: R$ " style="font-weight: bold;"/>
								<h:outputText id="totalDescontoArquivo" value=" #{bean.arquivoProcessado.totalDescontos}" converter="valorNumericoMoedaConverter"/>
				   			</div>	
						</div>	
						<div class="row"> 
							<div class="col-md-6 form-group">
								<h:outputLabel value="Total Remunerações: R$ " style="font-weight: bold;"/>
								<h:outputText id="totalRemuneracaoArquivo" value=" #{bean.arquivoProcessado.totalRemuneracao}" converter="valorNumericoMoedaConverter"/>
				   			</div>	
						</div>
					</div>
				</p:panel>
				<br/>	
			</div>	
		</ui:define>	
	
		<ui:define name="resultFiltro" >
			<p:dataTable styleClass="table table-responsive table-mobile"
					 id="pagamentos"
					 rows="20"
					 emptyMessage="Nenhum Pagamento foi processado."
					 value="#{bean.pagamentos}" 
  					 var="pag" 
  					 paginator="#{bean.pagamentos.size() > 0}"
  					 rendered="#{bean.pagamentos.size() > 0}"
       				 paginatorPosition="bottom"
  					 rowStyleClass="bgLinha1,bgLinha2">
		        
		        <p:column style="width:16px">
		            <p:rowToggler />
		        </p:column>
		        
				<p:column headerText="Matrícula" style="text-align:left;" >
	   				<h:outputText id="matricula" value="#{pag.matricula.numeroMatricula}" />
	   			</p:column>
	   			
				<p:column headerText="Nome" style="text-align:left;" >
	   				<h:outputText id="nome" value="#{pag.matricula.nomeFuncionario}" />
	   			</p:column>
	   			
				<p:column headerText="Função" style="text-align:left;" >
	   				<h:outputText id="funcao" value="#{pag.matricula.cargo.descricao}" />
	   			</p:column>

				<p:column headerText="Vínculo" style="text-align:left;" >
	   				<h:outputText id="vinculo" value="#{pag.matricula.vinculo.descricao}" />
	   			</p:column>
	   			
				<p:column headerText="CH" style="text-align:left;" >
	   				<h:outputText id="cargaHoraria" value="#{pag.matricula.cargaHoraria}" />
	   			</p:column>
				
				<p:column headerText="Proventos" style="text-align:right;" >
	   				<h:outputText id="totalProventos"  value="#{pag.totalProventos}" converter="valorNumericoMoedaConverter" />
	   			</p:column>
	   			
				<p:column headerText="Líquido" style="text-align:right;" >
	   				<h:outputText id="totalLiquido"  value="#{pag.totalLiquido}" converter="valorNumericoMoedaConverter" />
	   			</p:column>
	   			
				<p:column headerText="Desconto" style="text-align:right;" >
	   				<h:outputText id="totalDescontos" value="#{pag.totalDescontos}"  converter="valorNumericoMoedaConverter" />
	   			</p:column>
	   			
				<p:column headerText="Remuneração" style="text-align:right;" >
	   				<h:outputText id="totalRemuneracao"  value="#{pag.totalRemuneracao}"  converter="valorNumericoMoedaConverter" />
	   			</p:column>
	   			
	   			<p:rowExpansion>
           			<p:dataTable var="ep" value="#{pag.eventosPagamento}">
	           			<f:facet name="header">
					       <h:outputText id="matricula" value="#{pag.matricula.observacao}" />
					    </f:facet>
		           		<p:column headerText="Evento" style="text-align:left;" >
			   				<h:outputText id="nomeEvento" value="#{ep.evento.nome}" >
			   				</h:outputText>
			   			</p:column>
		           		<p:column headerText="Valor" style="text-align:right;" >
			   				<h:outputText id="valorEvento"  value="#{ep.valor}" converter="valorNumericoMoedaConverter" />
			   			</p:column>
           			</p:dataTable>
        		</p:rowExpansion>
	   			
			</p:dataTable> 
		</ui:define>
		
    </ui:composition>
	
</html>